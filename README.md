# Subscription Service

REST API сервис для управления подписками пользователей. Реализован на Go с использованием архитектурных принципов Clean Architecture.

## Стек технологий

- **Язык**: Go 1.25
- **Веб-фреймворк**: Gin Web Framework
- **База данных**: PostgreSQL
- **Драйвер БД**: pgx v5
- **Миграции**: Goose
- **Конфигурация**: CleanEnv
- **Документация API**: Swagger (Swaggo)
- **Контейнеризация**: Docker, Docker Compose

## Структура проекта

Проект следует стандартной структуре Go-проектов (Standard Go Project Layout):

- `cmd/app`: Точка входа в приложение.
- `internal`: Приватный код приложения (бизнес-логика, хранилище, транспортный уровень).
- `internal/config`: Логика конфигурации.
- `migrations`: SQL-файлы миграций базы данных.
- `pkg`: Общие библиотеки, которые могут использоваться внешними проектами.
- `docs`: Файлы документации Swagger.

## Запуск проекта

### Предварительные требования

- Docker и Docker Compose
- *Для локального запуска без Docker*: Go 1.25+, PostgreSQL

### Запуск через Docker Compose (Рекомендуется)

Самый простой способ запустить приложение вместе с базой данных.

1. Создайте файл `.env` на основе примера (если требуется переопределение переменных окружения):
   ```bash
   cp .env.example .env
   ```

2. Запустите контейнеры:
   ```bash
   docker-compose up --build
   ```

Приложение будет доступно по адресу `http://localhost:8080`.

### Локальный запуск

1. **Настройка базы данных**:
   Убедитесь, что PostgreSQL запущен. Создайте базу данных и укажите параметры подключения в `.env` файле или переменных окружения.

2. **Применение миграций**:
   Для работы приложения необходимо применить миграции базы данных.
   ```bash
   # Убедитесь, что у вас установлен goose
   go install github.com/pressly/goose/v3/cmd/goose@latest

   # Примените миграции (укажите ваш DSN)
   goose -dir migrations postgres "postgres://user:password@localhost:5432/dbname?sslmode=disable" up
   ```

3. **Запуск приложения**:
   Укажите путь к конфигурационному файлу через переменную окружения `CONFIG_PATH` и запустите:
   ```bash
   export CONFIG_PATH=internal/config/config.yaml
   go run cmd/app/main.go
   ```

## Конфигурация

Конфигурация приложения управляется через файл `config.yaml` и переменные окружения. Переменные окружения имеют приоритет над значениями в файле.

Основные параметры (см. `internal/config/config.go`):
- `APP_PORT`: Порт HTTP сервера.
- `POSTGRES_URL`: URL подключения к базе данных.
- `CONFIG_PATH`: Путь к файлу конфигурации (обязательно для локального запуска).

## API Документация

В проекте используется Swagger для описания API.

После запуска приложения Swagger UI доступен по адресу:
`http://localhost:8080/swagger/index.html`

Для регенерации документации после изменений в коде используйте `swag init`:
```bash
swag init -g cmd/app/main.go
```
